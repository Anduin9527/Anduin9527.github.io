---
title: 'WOC: ç¬¬ä¸€æ¬¡ç©æ¿å­'
tags: Linux
categories: é¡¹ç›®ç»å†
abbrlink: 84a02bf2
date: 2021-01-27 14:14:35
---



### å‰è¨€

è®°å½•å—é‚®æ ¡ç§‘å linux ç»„å¯’å‡ WOCï¼ˆwinter of codingï¼Ÿï¼Ÿï¼‰çš„ç»å†ã€‚

æœ‰ç»„é•¿ï¼ˆè™å°§å­¦é•¿ï¼‰çš„ä¿å§†çº§ PDFï¼Œä½“éªŒè‰¯å¥½ã€‚

<!--MORE-->

## å·¥å…·

#### ç¡¬ä»¶

1.LicheeZero å¼€å‘æ¿ï¼ˆARM æ¶æ„ï¼‰
2.12864 OLED(I2C æ¥å£ï¼ŒSSD1306 èŠ¯ç‰‡)
3.ç”µçƒ™é“ã€ç„Šé”¡ä¸
4.USB è½¬ä¸²å£æ¨¡å—(ç”±äºæ¿å­æ˜¯å°†ä¸²å£ä½œä¸ºç»ˆç«¯ï¼Œæ‰€ä»¥ä¸ºäº†è®© Xshell å¯ä»¥é€šè¿‡ usb å£è¿æ¥åˆ°ç»ˆç«¯ï¼Œè¿˜éœ€è¦è¿™
æ ·ä¸€ä¸ªæ¨¡å—)
4.æœé‚¦çº¿è‹¥å¹²(ç”¨äºè¿æ¥å„ä¸ªç¡¬ä»¶è®¾å¤‡)
5.TF å¡ã€è¯»å¡å™¨
6.USB A to Micro USB è¿æ¥çº¿(ç”¨äºè¿æ¥ lichee zero å’Œç”µè„‘)

#### è½¯ä»¶

1.ubuntu20.04 LTSï¼ˆWSLï¼‰

2.Xshell

3.VMware Pro

4.Kali20.04

## ä¸€äº›æ¦‚å¿µ

ç³»ç»Ÿä¸Šç”µ---> bootrom---> uboot---> kernel åŠ è½½---> init---> åº”ç”¨ç¨‹åº

### UBOOT

U-Bootï¼Œå…¨ç§° Universal Boot Loaderï¼Œæ˜¯éµå¾ª GPL æ¡æ¬¾æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œç”¨äºå¯åŠ¨æ“ä½œç³»ç»Ÿå†…æ ¸ï¼Œæ“ä½œç³»ç»Ÿå¹¶ä¸æ˜¯ä¸€å¼€æœºå°±ä¼šè‡ªåŠ¨å¯åŠ¨ï¼Œæ˜¯è¦æœ‰å¼•å¯¼ç¨‹åºçš„ã€‚å°±ç±»ä¼¼äº BIOS ä¸€ç±»çš„å­˜åœ¨

#### ç»“æ„

```
â”œâ”€â”€ api                å­˜æ”¾ubootæä¾›çš„APIæ¥å£å‡½æ•°
â”œâ”€â”€ arch               å¹³å°ç›¸å…³çš„éƒ¨åˆ†æˆ‘ä»¬åªéœ€è¦å…³å¿ƒè¿™ä¸ªç›®å½•ä¸‹çš„ARMæ–‡ä»¶å¤¹
â”‚   â”œâ”€â”€arm
â”‚   â”‚   â””â”€â”€cpu
â”‚   â”‚   â”‚   â””â”€â”€armv7
â”‚   â”‚   â””â”€â”€dts
â”‚   â”‚   â”‚   â””â”€â”€*.dts å­˜æ”¾è®¾å¤‡çš„dts,ä¹Ÿå°±æ˜¯è®¾å¤‡é…ç½®ç›¸å…³çš„å¼•è„šä¿¡æ¯
â”œâ”€â”€ board              å¯¹äºä¸åŒçš„å¹³å°çš„å¼€å‘æ¿å¯¹åº”çš„ä»£ç 
â”œâ”€â”€ cmd                é¡¾åæ€ä¹‰ï¼Œå¤§éƒ¨åˆ†çš„å‘½ä»¤çš„å®ç°éƒ½åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹é¢ã€‚
â”œâ”€â”€ common             å…¬å…±çš„ä»£ç 
â”œâ”€â”€ configs            å„ä¸ªæ¿å­çš„å¯¹åº”çš„é…ç½®æ–‡ä»¶éƒ½åœ¨é‡Œé¢ï¼Œæˆ‘ä»¬çš„Licheeé…ç½®ä¹Ÿåœ¨é‡Œé¢
â”œâ”€â”€ disk               å¯¹ç£ç›˜çš„ä¸€äº›æ“ä½œéƒ½åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹é‡Œé¢ï¼Œä¾‹å¦‚åˆ†åŒºç­‰ã€‚
â”œâ”€â”€ doc                å‚è€ƒæ–‡æ¡£ï¼Œè¿™é‡Œé¢æœ‰å¾ˆå¤šè·Ÿå¹³å°ç­‰ç›¸å…³çš„ä½¿ç”¨æ–‡æ¡£ã€‚
â”œâ”€â”€ drivers            å„å¼å„æ ·çš„é©±åŠ¨æ–‡ä»¶éƒ½åœ¨è¿™é‡Œé¢
â”œâ”€â”€ dts                ä¸€ç§æ ‘å½¢ç»“æ„ï¼ˆdevice treeï¼‰è¿™ä¸ªåº”è¯¥æ˜¯ubootæ–°çš„è¯­æ³•
â”œâ”€â”€ examples           å®˜æ–¹ç»™å‡ºçš„ä¸€äº›æ ·ä¾‹ç¨‹åº
â”œâ”€â”€ fs                 æ–‡ä»¶ç³»ç»Ÿï¼Œubootä¼šç”¨åˆ°çš„ä¸€äº›æ–‡ä»¶ç³»ç»Ÿ
â”œâ”€â”€ include            å¤´æ–‡ä»¶ï¼Œæ‰€æœ‰çš„å¤´æ–‡ä»¶éƒ½åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹é¢
â”œâ”€â”€ lib                ä¸€äº›å¸¸ç”¨çš„åº“æ–‡ä»¶åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹é¢
â”œâ”€â”€ Licenses           è¿™ä¸ªå…¶å®è·Ÿç¼–è¯‘æ— å…³äº†ï¼Œå°±æ˜¯ä¸€äº›licenseçš„å£°æ˜
â”œâ”€â”€ net                ç½‘ç»œç›¸å…³çš„ï¼Œéœ€è¦ç”¨çš„å°å‹ç½‘ç»œåè®®æ ˆ
â”œâ”€â”€ post              ä¸Šç”µè‡ªæ£€ç¨‹åº
â”œâ”€â”€ scripts           ç¼–è¯‘è„šæœ¬å’ŒMakefileæ–‡ä»¶
â”œâ”€â”€ spl               second program loaderï¼Œå³ç›¸å½“äºäºŒçº§ubootå¯åŠ¨ã€‚
â”œâ”€â”€ test              å°å‹çš„å•å…ƒæµ‹è¯•ç¨‹åºã€‚
â””â”€â”€ tools             é‡Œé¢æœ‰å¾ˆå¤šubootå¸¸ç”¨çš„å·¥å…·ã€‚
```

ä¿®æ”¹ include/configs/sun8i.h

![image-20210320111620165](https://i.loli.net/2021/03/20/HebqMxLQw6dfcau.png)

+ è¿™æ˜¯æ˜¯å‘ŠçŸ¥ U-BOOT åœ¨å¼•å¯¼å¯åŠ¨çš„æ—¶å€™åœ¨ç›¸åº”çš„å†…å­˜åœ°å€å¯»æ‰¾å¹¶è½½å…¥ç›¸åº”çš„â€œåŒ…â€

```bash
sudo ARCH=arm make menuconfig //è¿›è¡Œå†…æ ¸é€‰é¡¹çš„è°ƒæ•´
```

### LinuxKernel

ç³»ç»Ÿå†…æ ¸ï¼ˆKernelï¼‰æ˜¯æ•´ä¸ªæ“ä½œç³»ç»Ÿçš„æœ€åº•å±‚ï¼Œå®ƒè´Ÿè´£æ•´ä¸ªç¡¬ä»¶çš„é©±åŠ¨ï¼Œä»¥åŠæä¾›å„ç§ç³»ç»Ÿæ‰€éœ€çš„æ ¸å¿ƒ
åŠŸèƒ½ï¼ŒåŒ…æ‹¬é˜²ç«å¢™æœºåˆ¶ã€æ˜¯å¦æ”¯æŒ LVM æˆ– Quota ç­‰æ–‡ä»¶ç³»ç»Ÿç­‰ç­‰ï¼Œå¦‚æœå†…æ ¸ä¸è®¤è¯†æŸä¸ªæœ€æ–°çš„ç¡¬ä»¶ï¼Œé‚£
ä¹ˆç¡¬ä»¶ä¹Ÿå°±æ— æ³•è¢«é©±åŠ¨ï¼Œä½ ä¹Ÿå°±æ— æ³•ä½¿ç”¨è¯¥ç¡¬ä»¶ã€‚è®¡ç®—æœºçœŸæ­£å·¥ä½œçš„ä¸œè¥¿å…¶å®æ˜¯ç¡¬ä»¶ï¼Œä¾‹å¦‚æ•°å€¼è¿ç®—è¦
ä½¿ç”¨åˆ° CPUã€æ•°æ®å‚¨å­˜è¦ä½¿ç”¨åˆ°ç¡¬ç›˜ã€å›¾å½¢æ˜¾ç¤ºä¼šç”¨åˆ°æ˜¾ç¤ºé€‚é…å™¨ã€éŸ³ä¹å‘å£°è¦æœ‰éŸ³æ•ˆèŠ¯ç‰‡ã€è¿æ¥
Internet å¯èƒ½éœ€è¦ç½‘ç»œå¡ç­‰ç­‰ã€‚å†…æ ¸å°±æ˜¯æ§åˆ¶è¿™äº›èŠ¯ç‰‡å¦‚ä½•å·¥ä½œã€‚

Linux å†…æ ¸ç”±å¦‚ä¸‹å‡ éƒ¨åˆ†ç»„æˆï¼šå†…å­˜ç®¡ç†ã€è¿›ç¨‹ç®¡ç†ã€è®¾å¤‡é©±åŠ¨ç¨‹åºã€æ–‡ä»¶ç³»ç»Ÿå’Œç½‘ç»œç®¡ç†ç­‰ã€‚

+ FUN ï¼šå†…æ ¸ä¸èƒ½è°ƒ C åº“å‡½æ•°

+ é»˜è®¤é…ç½®å°±å¥½ï¼Œä½†æ˜¯æˆ‘ä¸ºäº†åç»­çš„åˆ©ç”¨ OTG å…±äº«ç½‘ç»œè¿™é‡Œå°±è®¾ç½®äº†ä¸€ä¸‹ USB GADGET
+ device drivers-> usb support > usb gadget support

![](https://i.loli.net/2021/03/20/WJbmwMkGLutFgZB.png)

### buildroot

buildroot æ˜¯ä¸€ä¸ªç®€å•ä»¥åŠè‡ªåŠ¨åŒ–çš„å·¥å…·ï¼Œå¯ä»¥ä½¿ç”¨äº¤å‰ç¼–è¯‘ä¸ºåµŒå…¥å¼ç³»ç»Ÿæ„å»ºä¸€ä¸ªå®Œæ•´çš„ linux ç³»ç»Ÿã€‚ä¸ºäº†å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œbuildroot å¯ä»¥ç”Ÿæˆäº¤å‰å·¥å…·é“¾ï¼Œrootfsï¼Œlinux kernel é•œåƒå’Œ bootloaderã€‚å¹¶ä¸” buildroot å¯ä»¥é€‚ç”¨äºä»¥ä¸Šèµ„æºçš„ä»»æ„ç»„åˆæƒ…å†µ

### é©±åŠ¨

linux ç³»ç»Ÿå°†è®¾å¤‡åˆ†ä¸º 3 ç±»ï¼š**å­—ç¬¦è®¾å¤‡ã€å—è®¾å¤‡ã€ç½‘ç»œè®¾å¤‡**ã€‚

ç³»ç»Ÿè°ƒç”¨é€šè¿‡è®¾å¤‡æ–‡ä»¶çš„ **ä¸»è®¾å¤‡å·** æ‰¾åˆ°ç›¸åº”çš„è®¾å¤‡é©±åŠ¨ç¨‹åºï¼ˆæ¯ä¸€ä¸ªå­—ç¬¦è®¾å¤‡æˆ–å—è®¾å¤‡éƒ½åœ¨ **/dev** ç›®å½•ä¸‹å¯¹åº”ä¸€ä¸ªè®¾å¤‡æ–‡ä»¶ã€‚ï¼‰ï¼Œç„¶åè¯»å–è¿™ä¸ªæ•°æ®ç»“æ„ç›¸åº”çš„å‡½æ•°æŒ‡é’ˆï¼Œæ¥ç€æŠŠæ§åˆ¶æƒäº¤ç»™è¯¥å‡½æ•°ï¼Œè¿™æ˜¯ Linux çš„è®¾å¤‡é©±åŠ¨ç¨‹åºå·¥ä½œçš„åŸºæœ¬åŸç†ã€‚

ä»¥å­—ç¬¦è®¾å¤‡é©±åŠ¨ç¼–å†™ä¸ºä¾‹ï¼š

+ ç¡®å®šä¸»è®¾å¤‡å·ï¼ˆç”¨äºè¯†åˆ«è®¾å¤‡æ–‡ä»¶ï¼Œåœ¨é©±åŠ¨ç¨‹åºä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº›æ•°å­—å®šä¹‰ä¸ºå¸¸é‡ï¼‰, ä¹Ÿå¯ä»¥è®©å†…æ ¸åˆ†é…
+ å®šä¹‰ **file_operations** ç»“æ„ä½“
+ æ‰‹åŠ¨å®ç°å¯¹åº”çš„ drv-open/drv-read/drv-write ç­‰å‡½æ•°, å¡«å…¥ file_operations ç»“æ„ä½“
+ æŠŠ file-operations ç»“æ„ä½“å‘Šè¯‰å†…æ ¸
+ å®‰è£…é©±åŠ¨ç¨‹åºæ—¶, å°±ä¼šå»è°ƒç”¨å…¥å£å‡½æ•°(module_init)
+ å¸è½½é©±åŠ¨ç¨‹åºæ—¶, è°ƒç”¨å‡ºå£å‡½æ•°(module_exit)

## è¸©å‘

### 1.ARCH = arm make menuconfig

æŠ¥é”™ä¿¡æ¯ï¼š

```bash
HOSTCC  scripts/kconfig/mconf.o
<command-line>: fatal error: curses.h: No such file or directory
compilation terminated.
make[1]: *** [scripts/Makefile.host:116: scripts/kconfig/mconf.o] Error 1
make: *** [Makefile:478: menuconfig] Error 2
```

è§£å†³ï¼š([chentao1206](https://blog.csdn.net/chentao1206))[https://blog.csdn.net/chentao1206/article/details/51280610]

åœ¨ **Debian/ Ubuntu Linux** ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥å®‰è£… ncurses:

```bash
sudo apt-get install libncurses5-dev libncursesw5-dev
```

åœ¨ **RHEL / Fedora / CentOS Linux** ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

```bash
yum install ncurses-devel ncurses
```

### 2.Buildroot ç¼–è¯‘ Error

Win10 WSL ç³»ç»Ÿä¸‹ç¼–è¯‘ buildroot æŠ¥é”™ä¸æ”¯æŒ SYSV IPCï¼Œå¯¼è‡´ fakeroot æ— æ³•æ­£å¸¸å·¥ä½œ 

æŠ¥é”™ä¿¡æ¯ï¼š

```bash
fakeroot, while creating message channels: Function not implemented
This may be due to a lack of SYSV IPC support.
fakeroot: error while starting the `faked' daemon.
kill: usage: kill [-s sigspec | -n signum | -sigspec] pid | jobspec ... or kill -l [sigspec]
make: *** [fs/tar/tar.mk:32: /home/anduin9527/buildroot-2017.08.1/output/images/rootfs.tar] Error 1
```

è§£å†³ï¼š[Error while building rootfs system for Raspberry Pi 3 using Buildroot - lack of SysV IPC support](https://stackoverflow.com/questions/45469650/error-while-building-rootfs-system-for-raspberry-pi-3-using-buildroot-lack-of)

ä¿®æ”¹ buildroot-> fs ç›®å½•ä¸‹çš„ common.mk æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```c
# å°†ä»¥ä¸‹
PATH= $$(BR_PATH) $  $(HOST_DIR)/bin/fakeroot -- $ $(FAKEROOT_SCRIPT)
# ä¿®æ”¹ä¸ºï¼š
if [ `uname -r | grep "Microsoft"` ] ; then \
    cp -f `which fakeroot-tcp` $$(HOST_DIR)/bin/fakeroot ; fi
```

### 3.Buildroot ç¼–è¯‘å®Œä¹‹åæ²¡æœ‰ç”Ÿæˆ rootfs.tar

è§£å†³ï¼šä¸ç”¨ buildroot ğŸ˜Ÿï¼Œè·³å‘ **debootstrap** çš„å‘ã€‚

### 4. debootstrap --foreign --verbose --arch = armhf stretch rootfs

æŠ¥é”™ä¿¡æ¯ï¼š

```
Failed getting release file http://ftp2.cn.debian.org/debian/dists/stretch/Release
```

è§£å†³ï¼š[Failed getting release file while running debootstrap with sudo](https://unix.stackexchange.com/questions/334303/failed-getting-release-file-while-running-debootstrap-with-sudo)

```bash
sudo debootstrap --foreign --verbose --arch=armhf  stretch rootfs https://mirrors.tuna.tsinghua.edu.cn/debian/
```

https://mirrors.tuna.tsinghua.edu.cn/debian/æ¯” http://ftp2.cn.debian.org/debian å¿«

### 5.DEBIAN è§£å‹

æŠ¥é”™ä¿¡æ¯ï¼š

```bash
chroot: failed to run command '/debootstrap/debootstrap': Exec format error
```

è§£å†³ï¼š[Ubuntu è™šæ‹Ÿæœºä½¿ç”¨ Debos æ„å»º Debian10](https://blog.csdn.net/m0_38096844/article/details/104625198)

```
sudo apt-get remove qemu-user-static     #å¸è½½
sudo apt-get install qemu-user-static    #é‡è£…
sudo update-binfmts --enable             #æ„å»ºä¹‹å‰è¿è¡Œ
```

### 6.sudo LC_ALL = C LANGUAGE = C LANG = C chroot rootfs

æŠ¥é”™ä¿¡æ¯ï¼š

```bash
chroot: failed to run command '/bin/zsh': No such file or directory
```

è§£å†³ï¼š

```bash
exec bash
```

### 7.WSL çƒ§å½•é—®é¢˜ ||ï¼ˆå¤ªæŠ˜ç£¨ï¼Œç©æ¿å­æ…ç”¨ WSLï¼‰

[è§£å†³ WSL çƒ§å½• SD å¡é—®é¢˜](https://blog.csdn.net/Rspate/article/details/109012675)

è¿˜æ˜¯ç­‰å·¨ç¡¬å‡º WSL3 å§

è§£å†³ï¼šç”¨ VMware+Kali ()

### 8.VM æ²¡æœ‰è‡ªåŠ¨è¯†åˆ« TF å¡

è§£å†³ï¼š

![image-20210128115617468](https://i.loli.net/2021/01/28/zny4adput8EcHZi.png)

çœ‹åˆ°é‚£ä¸ª USB å¤´äº†å—ï¼Œç‚¹ä»–ã€‚

å‚è€ƒï¼š[åè¡€ç»éªŒï¼ï¼ï¼è§£å†³è™šæ‹Ÿæœºè¿ä¸ä¸Š USBï¼æœ€å…¨ï¼](https://blog.csdn.net/qq_18649781/article/details/79941310?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.control&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.control)

### 9.é“¾æ¥ Xshell æŠ¥é”™å¹¶æ‰“å°ä¹±ç 

![image-20210212232052093](https://i.loli.net/2021/02/12/MaSNIUcg2ey1Rnw.png)

åœ¨æˆ‘ç»å†äº†å¤ç›˜ï¼Œåˆ·é•œåƒï¼Œæ‘¸äº†åå‡ å¤©æ··å…¥å®˜æ–¹ç¾¤åç»ˆäºå¾—åˆ°äº†ç­”æ¡ˆï¼š

![img](https://i.loli.net/2021/03/20/gv1AnEJmGwR5Qc6.png)

ç­”åº”æˆ‘ï¼Œç”¨å¥½ä¸€ç‚¹çš„ **ç”µçƒ™é“**ï¼Œä¹°å¥½ä¸€ç‚¹çš„ **æœé‚¦çº¿** å¥½å—

### 10.wifi

[è”ææ´¾ zero ç¼–è¯‘ rtl8723bs é©±åŠ¨å¹¶è¿æ¥ WiFi](https://blog.csdn.net/u012577474/article/details/104678522)

![image-20210321123347280](https://i.loli.net/2021/03/21/yJW1kZd4KT9wlBs.png)