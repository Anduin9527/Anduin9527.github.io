---
title: 情人节长夜漫漫，不如出道成为偶像
tags:
  - Python
  - Fun
categories: 整活
abbrlink: c84b9f7b
date: 2021-02-14 11:14:23
---

### 前言

公元2021年2月14日，又是一年春来到，又是一日虐狗时。与其看着空间朋友圈虐狗，不如出道成为虚拟偶像。

感谢大佬提供的轮子：https://github.com/pkhungurn/talking-head-anime-demo

![img](https://i.loli.net/2021/02/14/Wp7rhw4vsU2faRz.jpg)

<!--MORE-->

## 步骤

### 1 环境及材料准备：

```python
Python >= 3.6
pytorch >= 1.4.0
dlib >= 19.19
opencv-python >= 4.1.0.30
pillow >= 7.0.0
numpy >= 1.17.l2
```

下载[主要模型](https://drive.google.com/file/d/1ajHViqyLDKFKfBtGPE5cbSGcMNa8rz8k/view)以及[关键点预测器的shape_predictor_68_face_landmarks.dat](https://github.com/davisking/dlib-models)解压缩到data文件夹下

![image-20210214114308267](https://i.loli.net/2021/02/14/r832v1VKLFpMOgU.png)

+  **illust**中有作者带的测试图。

+ 自行制作头像图需满足一下要求：
  + 格式为256x256的PNG
  + 角色的头必须能包含在128x128的框中
  + 图像为RGBA四通道
  + 背景为透明

### 2 运行

我使用的是**vscode**。运行

```
app/manual_poser.py
app/puppeteer.py
```

### 3 踩坑

#### No module named 'poser.morph_rotate_combine_poser'; 

解决：

code_runner：在全局settings.json中加入`"code-runner.fileDirectoryAsCwd": true`

vscode运行器：就需要自己配置launch.json文件, 这时需要在configurations中加入`"cwd": "${fileDirname}"`

将 **manual_poser.py和puppeteer.py**中的

```python
sys.path.append(os.getcwd())
#修改为
sys.path.append("..")
```

参考：https://www.cnblogs.com/xfk1999/p/vscode-python-import-package.html

#### RuntimeError: Unable to open data/shape_predictor_68_face_landmarks.dat

解决：

发现是当前工作目录为app/

所以：

```python
landmark_locator = dlib.shape_predictor("data/shape_predictor_68_face_landmarks.dat")
#更改为
landmark_locator = dlib.shape_predictor("../data/shape_predictor_68_face_landmarks.dat")
```

同理，将所有相对路径的代码块进行以上修改。

#### Nothing yet!

![无标题](https://i.loli.net/2021/02/14/ZLIEUz6SNrxJjlQ.png)

首先请确保正确安装了CUDA（11.0），并且安装了与之**相对应**的pytorch（1.7）版本

```python
import torch
print(torch.__version__)

print(torch.version.cuda)
torch.cuda.is_available() //返回TRUE说明成功了
```

![image-20210214163600760](https://i.loli.net/2021/02/14/RIQkeVqHCajLUWm.png)

## 成品

![1](https://i.loli.net/2021/02/14/gS6QiyPVl8wxYtf.png)

![22](https://i.loli.net/2021/02/14/7IY2QbP9sVUyHxX.png)