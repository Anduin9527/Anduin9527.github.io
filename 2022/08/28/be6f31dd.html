<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#66d6ff"><meta name="author" content="Anduin9527"><meta name="copyright" content="Anduin9527"><meta name="generator" content="Hexo 6.2.0"><meta name="theme" content="hexo-theme-yun"><title>计算机组成原理笔记（八） | Anduin9527的乖离器</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/star-markdown-css@0.3.3/dist/yun/yun-markdown.min.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/prism-theme-vars/base.css"><script src="https://fastly.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".markdown-body img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="stylesheet" type="text/css" href="https://fastly.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script defer src="https://fastly.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script><script defer src="https://fastly.jsdelivr.net/npm/katex@latest/dist/contrib/auto-render.min.js"></script><script type="module">import { renderKatex } from '/js/utils.js'
document.addEventListener("DOMContentLoaded", () => {
  renderKatex({
    ...{},
    ...true?.options,
  });
});</script><link rel="icon" type="image/svg+xml" href="/images/favicon.svg"><link rel="mask-icon" href="/images/favicon.svg" color="#66d6ff"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="preconnect" href="https://fastly.jsdelivr.net/npm/" crossorigin><script id="yun-config">
    window.Yun = {}
    window.CONFIG = {"hostname":"lapras.xyz","root":"/","title":["拉普","拉斯~","的","乖离器"],"version":"1.10.6","mode":"time","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}.","hits":"${hits} results found","hits_time":"${hits} results found in ${time} ms"},"anonymous_image":"https://cdn.yunyoujun.cn/img/avatar/none.jpg","fireworks":{"colors":["#00D1CE","#66D6FF","#919191"]},"vendors":{"host":"https://fastly.jsdelivr.net/npm/","darken":"https://fastly.jsdelivr.net/npm/darken@1.5.0"}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/hexo-theme-yun.js" type="module"></script><link rel="alternate" href="/atom.xml" title="Anduin9527的乖离器" type="application/atom+xml"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap"><script src="/h" async></script><script src="/t" async></script><script src="/t" async></script><script src="/p" async></script><script src="/s" async></script><script src="/:" async></script><script src="/" async></script><script src="/" async></script><script src="/c" async></script><script src="/d" async></script><script src="/n" async></script><script src="/." async></script><script src="/j" async></script><script src="/s" async></script><script src="/d" async></script><script src="/e" async></script><script src="/l" async></script><script src="/i" async></script><script src="/v" async></script><script src="/r" async></script><script src="/." async></script><script src="/n" async></script><script src="/e" async></script><script src="/t" async></script><script src="/" async></script><script src="/n" async></script><script src="/p" async></script><script src="/m" async></script><script src="/" async></script><script src="/i" async></script><script src="/o" async></script><script src="/n" async></script><script src="/i" async></script><script src="/c" async></script><script src="/o" async></script><script src="/n" async></script><script src="/s" async></script><script src="/" async></script><script src="/d" async></script><script src="/i" async></script><script src="/s" async></script><script src="/t" async></script><script src="/" async></script><script src="/i" async></script><script src="/o" async></script><script src="/n" async></script><script src="/i" async></script><script src="/c" async></script><script src="/o" async></script><script src="/n" async></script><script src="/s" async></script><script src="/." async></script><script src="/j" async></script><script src="/s" async></script><link rel="preconnect" href="https://www.google-analytics.com" crossorigin><script async src="https://www.googletagmanager.com/gtag/js?id=G-NSLVQ2H5JH"></script><script>if (CONFIG.hostname === location.hostname) {
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-NSLVQ2H5JH');
}</script><script>(function(){
  var bp = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  if (curProtocol === 'https') {
    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else {
    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
})();</script><meta name="description" content="前言 开学了！G！">
<meta property="og:type" content="article">
<meta property="og:title" content="计算机组成原理笔记（八）">
<meta property="og:url" content="http://lapras.xyz/2022/08/28/be6f31dd.html">
<meta property="og:site_name" content="Anduin9527的乖离器">
<meta property="og:description" content="前言 开学了！G！">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/chao.jpg">
<meta property="og:image" content="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/CPU%E7%BB%93%E6%9E%84%E6%A1%86%E5%9B%BE.png">
<meta property="og:image" content="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/%E6%8C%87%E4%BB%A4%E5%91%A8%E6%9C%9F1.png">
<meta property="og:image" content="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/%E6%8C%87%E4%BB%A4%E5%91%A8%E6%9C%9F2.png">
<meta property="og:image" content="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/%E6%8C%87%E4%BB%A4%E5%91%A8%E6%9C%9F3.png">
<meta property="og:image" content="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/%E6%8C%87%E4%BB%A4%E5%91%A8%E6%9C%9F4.png">
<meta property="og:image" content="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/%E6%8C%87%E4%BB%A4%E5%91%A8%E6%9C%9F5.png">
<meta property="og:image" content="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/%E6%8C%87%E4%BB%A4%E5%91%A8%E6%9C%9F%E6%B5%81%E7%A8%8B.png">
<meta property="og:image" content="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/CPU%E5%B7%A5%E4%BD%9C%E5%91%A8%E6%9C%9F%E7%9A%84%E6%A0%87%E8%AF%86.png">
<meta property="og:image" content="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/%E5%8F%96%E5%80%BC%E5%91%A8%E6%9C%9F%E7%9A%84%E6%95%B0%E6%8D%AE%E6%B5%811.png">
<meta property="og:image" content="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/%E7%AE%80%E7%9B%B4%E5%91%A8%E6%9C%9F%E7%9A%84%E6%95%B0%E6%8D%AE%E6%B5%81.png">
<meta property="og:image" content="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/%E4%B8%AD%E6%96%AD%E5%91%A8%E6%9C%9F%E6%95%B0%E6%8D%AE%E6%B5%81.png">
<meta property="og:image" content="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/%E6%B5%81%E6%B0%B4%E7%BA%BF%E7%A4%BA%E6%84%8F%E5%9B%BE.png">
<meta property="og:image" content="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/%E5%85%AD%E7%BA%A7%E6%B5%81%E6%B0%B4.png">
<meta property="og:image" content="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/%E5%90%9E%E5%90%90%E7%8E%871.png">
<meta property="og:image" content="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/%E6%B5%81%E6%B0%B4%E7%BA%BF%E6%95%88%E7%8E%87%E5%9B%BE.png">
<meta property="og:image" content="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/%E8%B6%85%E6%A0%87%E9%87%8F%E6%8A%80%E6%9C%AF.png">
<meta property="og:image" content="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/%E8%B6%85%E6%B5%81%E6%B0%B4%E7%BA%BF%E6%8A%80%E6%9C%AF6.png">
<meta property="og:image" content="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/%E8%B6%85%E9%95%BF%E6%8C%87%E4%BB%A4%E5%AD%97%E6%8A%80%E6%9C%AF.png">
<meta property="og:image" content="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/CPU%E4%B8%AD%E6%96%AD%E5%88%A4%E4%BC%98.png">
<meta property="og:image" content="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/%E8%BD%AF%E4%BB%B6%E5%AE%9E%E7%8E%B0%E4%B8%AD%E6%96%AD.png">
<meta property="article:published_time" content="2022-08-28T08:37:25.238Z">
<meta property="article:modified_time" content="2022-08-28T08:38:25.323Z">
<meta property="article:author" content="Anduin9527">
<meta property="article:tag" content="笔记">
<meta property="article:tag" content="硬件">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/chao.jpg"><script type="module">import { getScript } from '/js/utils.js'
getScript("https://fastly.jsdelivr.net/npm/mermaid/dist/mermaid.min.js", () => {
  const mermaidOptions = {"startOnload":true}
  mermaid.initialize(mermaidOptions);
}, window.mermaid);
</script><style>.mermaid{background: transparent;}</style><script>(function() {
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
  const setting = localStorage.getItem('darken-mode') || 'auto'
  if (setting === 'dark' || (prefersDark && setting !== 'light'))
    document.documentElement.classList.toggle('dark', true)
})()</script></head><body><script src="https://code.iconify.design/2/2.1.1/iconify.min.js"></script><script>// Define global variable
IconifyProviders = {
  // Empty prefix: overwrite default API provider configuration
  '': {
    // Use custom API first, use Iconify public API as backup
    resources: [
        'https://api.iconify.design',
    ],
    // Wait for 1 second before switching API hosts
    rotate: 1000,
  },
};</script><script defer src="https://fastly.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js" type="module"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js" type="module"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="Table of Contents"><span class="icon iconify" data-icon="ri:list-ordered"></span></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="Overview"><span class="icon iconify" data-icon="ri:passport-line"></span></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="Anduin9527"><img width="96" loading="lazy" src="/images/avatar.jpg" alt="Anduin9527"><span class="site-author-status" title="建模建模呜呜呜！">😭</span></a><div class="site-author-name"><a href="/about/">Anduin9527</a></div><span class="site-name">Anduin9527的乖离器</span><sub class="site-subtitle">正在进修摸鱼学导论</sub><div class="site-description">南邮摸鱼ing</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="Home"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:home-4-line"></span></span></a><div class="site-state-item"><a href="/archives/" title="Archives"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:archive-line"></span></span><span class="site-state-item-count">45</span></a></div><div class="site-state-item"><a href="/categories/" title="Categories"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:folder-2-line"></span></span><span class="site-state-item-count">10</span></a></div><div class="site-state-item"><a href="/tags/" title="Tags"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="site-state-item-count">30</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="文档"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:settings-line"></span></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="tencent://message/?uin=2676057183&amp;Site=&amp;Menu=yes" title="QQ" target="_blank" style="color:#12B7F5"><span class="icon iconify" data-icon="ri:qq-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/Anduin9527" title="GitHub" target="_blank" style="color:#181717"><span class="icon iconify" data-icon="ri:github-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:2676057183@qq.com" title="E-Mail" target="_blank" style="color:#8E71C1"><span class="icon iconify" data-icon="ri:mail-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://music.163.com/#/user/home?id=579015212" title="网易云音乐" target="_blank" style="color:#C10D0C"><span class="icon iconify" data-icon="ri:netease-cloud-music-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://www.zhihu.com/people/chu-liu-16-64" title="知乎" target="_blank" style="color:#0084FF"><span class="icon iconify" data-icon="ri:zhihu-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://space.bilibili.com/21994551" title="哔哩哔哩动画" target="_blank" style="color:#FF8EB3"><span class="icon iconify" data-icon="ri:bilibili-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="/atom.xml" title="RSS" target="_blank" style="color:orange"><span class="icon iconify" data-icon="ri:rss-line"></span></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="我的小伙伴们" style="color:dodgerblue"><span class="icon iconify" data-icon="ri:genderless-line"></span></a><a class="links-item hty-icon-button" href="/girls/" title="我永远喜欢oo" style="color:hotpink"><span class="icon iconify" data-icon="ri:women-line"></span></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><span class="icon iconify" data-icon="ri:contrast-2-line"></span></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cpu-%E7%BB%93%E6%9E%84"><span class="toc-text">CPU 结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E5%99%A8%E7%9A%84%E5%8A%9F%E8%83%BD"><span class="toc-text">控制器的功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cpu-%E7%BB%93%E6%9E%84%E6%A1%86%E5%9B%BE"><span class="toc-text">CPU 结构框图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cpu-%E7%9A%84%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-text">CPU 的寄存器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E5%8F%AF%E8%A7%81%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-text">用户可见寄存器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-text">控制寄存器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-text">状态寄存器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%87%E4%BB%A4%E5%91%A8%E6%9C%9F"><span class="toc-text">指令周期</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%80%A7%E8%B4%A8"><span class="toc-text">基本性质</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%87%E4%BB%A4%E5%91%A8%E6%9C%9F%E7%B1%BB%E5%9E%8B"><span class="toc-text">指令周期类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%87%E4%BB%A4%E5%91%A8%E6%9C%9F%E6%B5%81%E7%A8%8B"><span class="toc-text">指令周期流程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cpu-%E5%B7%A5%E4%BD%9C%E5%91%A8%E6%9C%9F%E7%9A%84%E6%A0%87%E5%BF%97"><span class="toc-text">CPU 工作周期的标志</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%B5%81"><span class="toc-text">数据流</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%96%E5%80%BC%E5%91%A8%E6%9C%9F%E7%9A%84%E6%95%B0%E6%8D%AE%E6%B5%81"><span class="toc-text">取值周期的数据流</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%B4%E5%9D%80%E5%91%A8%E6%9C%9F%E7%9A%84%E6%95%B0%E6%8D%AE%E6%B5%81"><span class="toc-text">间址周期的数据流</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E5%91%A8%E6%9C%9F%E7%9A%84%E6%95%B0%E6%8D%AE%E6%B5%81"><span class="toc-text">执行周期的数据流</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%AD%E6%96%AD%E5%91%A8%E6%9C%9F%E7%9A%84%E6%95%B0%E6%8D%AE%E6%B5%81"><span class="toc-text">中断周期的数据流</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%87%E4%BB%A4%E6%B5%81%E6%B0%B4"><span class="toc-text">指令流水</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%87%E4%BB%A4%E6%B5%81%E6%B0%B4%E5%8E%9F%E7%90%86"><span class="toc-text">指令流水原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BD%B1%E5%93%8D%E6%8C%87%E4%BB%A4%E6%B5%81%E6%B0%B4%E6%80%A7%E8%83%BD%E7%9A%84%E5%9B%A0%E7%B4%A0"><span class="toc-text">影响指令流水性能的因素</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E7%9B%B8%E5%85%B3"><span class="toc-text">结构相关</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%9B%B8%E5%85%B3"><span class="toc-text">数据相关</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E7%9B%B8%E5%85%B3"><span class="toc-text">控制相关</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%81%E6%B0%B4%E7%BA%BF%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87"><span class="toc-text">流水线性能指标</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%9E%E5%90%90%E7%8E%87"><span class="toc-text">吞吐率</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A0%E9%80%9F%E6%AF%94"><span class="toc-text">加速比</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%88%E7%8E%87"><span class="toc-text">效率</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%81%E6%B0%B4%E7%BA%BF%E7%9A%84%E5%A4%9A%E5%8F%91%E6%8A%80%E6%9C%AF"><span class="toc-text">流水线的多发技术</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B6%85%E6%A0%87%E9%87%8F%E6%8A%80%E6%9C%AF"><span class="toc-text">超标量技术</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B6%85%E6%B5%81%E6%B0%B4%E7%BA%BF%E6%8A%80%E6%9C%AF"><span class="toc-text">超流水线技术</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B6%85%E9%95%BF%E6%8C%87%E4%BB%A4%E5%AD%97%E6%8A%80%E6%9C%AF"><span class="toc-text">超长指令字技术</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E6%96%AD%E7%B3%BB%E7%BB%9F"><span class="toc-text">中断系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-text">概述</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%95%E8%B5%B7%E4%B8%AD%E6%96%AD%E7%9A%84%E5%9B%A0%E7%B4%A0"><span class="toc-text">引起中断的因素</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E6%96%AD%E8%AF%B7%E6%B1%82%E6%A0%87%E8%AE%B0%E5%92%8C%E4%B8%AD%E6%96%AD%E5%88%A4%E4%BC%98%E9%80%BB%E8%BE%91"><span class="toc-text">中断请求标记和中断判优逻辑</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%AD%E6%96%AD%E8%AF%B7%E6%B1%82%E6%A0%87%E8%AE%B0"><span class="toc-text">中断请求标记</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%AD%E6%96%AD%E5%88%A4%E4%BC%98%E9%80%BB%E8%BE%91"><span class="toc-text">中断判优逻辑</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E6%96%AD%E6%9C%8D%E5%8A%A1%E7%A8%8B%E5%BA%8F%E5%9C%B0%E5%9D%80%E7%9A%84%E5%AF%BB%E6%89%BE"><span class="toc-text">中断服务程序地址的寻找</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E6%96%AD%E5%93%8D%E5%BA%94"><span class="toc-text">中断响应</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E4%B8%AD%E6%96%AD%E7%9A%84%E6%9D%A1%E4%BB%B6"><span class="toc-text">响应中断的条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E4%B8%AD%E6%96%AD%E7%9A%84%E6%97%B6%E9%97%B4"><span class="toc-text">响应中断的时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%AD%E6%96%AD%E9%9A%90%E6%8C%87%E4%BB%A4"><span class="toc-text">中断隐指令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E6%96%AD%E5%B1%8F%E8%94%BD%E6%8A%80%E6%9C%AF"><span class="toc-text">中断屏蔽技术</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%A4%9A%E9%87%8D%E4%B8%AD%E6%96%AD%E7%9A%84%E6%9D%A1%E4%BB%B6"><span class="toc-text">实现多重中断的条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B1%8F%E8%94%BD%E6%8A%80%E6%9C%AF"><span class="toc-text">屏蔽技术</span></a></li></ol></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article" style="--smc-primary:#66d6ff;"><link itemprop="mainEntityOfPage" href="http://lapras.xyz/2022/08/28/be6f31dd.html"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="Anduin9527"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="Anduin9527的乖离器"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">计算机组成原理笔记（八）</h1><div class="post-meta"><div class="post-time" style="display:block"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-line"></span></span> <time title="Created: 2022-08-28 16:37:25" itemprop="dateCreated datePublished" datetime="2022-08-28T16:37:25+08:00">2022-08-28</time></div><span class="post-count"><span class="post-symbolcount"><span class="post-meta-item-icon" title="Word count in article"><span class="icon iconify" data-icon="ri:file-word-line"></span></span> <span title="Word count in article">6.7k</span><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="Reading time"><span class="icon iconify" data-icon="ri:timer-line"></span></span> <span title="Reading time">23m</span></span></span><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><span class="icon iconify" data-icon="ri:folder-line"></span></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" style="--text-color:#736e30" itemprop="url" rel="index"><span itemprop="text">计算机组成原理</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/%E7%AC%94%E8%AE%B0/" style="--text-color:dimgray"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">笔记</span></a><a class="tag-item" href="/tags/%E7%A1%AC%E4%BB%B6/" style="--text-color:#ecf0f1"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">硬件</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body"><h2 id="前言">前言</h2>
<p>开学了！G！</p>
<p><img src="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/chao.jpg" alt="100750654_p0_master1200" style="zoom:80%;" / loading="lazy"></p>
<span id="more"></span>
<h2 id="cpu-结构">CPU 结构</h2>
<h3 id="控制器的功能">控制器的功能</h3>
<p>对于冯诺依曼结构的计算机而言，一旦程序进入存储器后，就可由计算机自动完成取指令和执行指令的任务，<strong>控制器</strong> 就是专用于完成此项工作的，它负责协调并控制计算机各部件执行程序的指令序列，其基本功能是取指令、分析指令和执行指令。</p>
<ol type="1">
<li><p>取指令</p>
<p>控制器必须具备能自动地从存储器中取出指令的功能。为此，要求控制器能自动形成指令的地址，并能发出取指令的命令，将对应此地址的指令取到控制器中。第一条指令的地址可以人为指定，也可由系统设定。</p></li>
<li><p>分析指令</p>
<p>分析指令包括两部分内容：其一，分析此指令要完成什么操作，即控制器需发出什么操作命令；其二，分析参与这次操作的操作数地址，即操作数的有效地址。</p></li>
<li><p>执行指令 执行指令就是根据分析指令产生的“操作命令”和“操作数地址”的要求，形成操作控制信号序列。</p></li>
<li><p>控制程序的输入和运算结果的输出，即控制主机与 I/0 设备交换信息</p></li>
<li><p>总线管理</p></li>
<li><p>处理机器运行过程中出现的异常情况和特殊请求</p></li>
</ol>
<blockquote>
<p>总之，CPU 必须具有控制程序的顺序执行（称指令控制）、产生完成每条指令所需的控制命令（称操作控制）、对各种操作加以时间上的控制（称时间控制）、对数据进行算术运算和逻辑运算（数据加工）以及处理中断等功能。</p>
</blockquote>
<h3 id="cpu-结构框图">CPU 结构框图</h3>
<p><img src="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/CPU%E7%BB%93%E6%9E%84%E6%A1%86%E5%9B%BE.png" alt="image-20220822225230720" style="zoom:80%;" / loading="lazy"></p>
<ul>
<li>指令控制：<span class="math inline">\(PC\)</span>（指出了要取出的指令的地址）和 <span class="math inline">\(IR\)</span>（存放当前指令的地址）</li>
<li>操作控制 时间控制：<span class="math inline">\(CU\)</span>和时序电路</li>
<li>数据加工：<span class="math inline">\(ALU\)</span>和寄存器</li>
<li>处理中断：中断系统</li>
</ul>
<h3 id="cpu-的寄存器">CPU 的寄存器</h3>
<h4 id="用户可见寄存器">用户可见寄存器</h4>
<p>通常 CPU 执行机器语言访问的寄存器为用户可见寄存器，按其特征又可分为以下几类。</p>
<ol type="1">
<li><p>通用寄存器：通用寄存器可由程序设计者指定许多功能，可用于存放操作数，也可作为满足某种寻址方式所需的寄存器。例如，基址寻址所需的基址寄存器、变址寻址所需的变址寄存器和堆栈寻址所需的栈指针，都可用通用寄存器代替。寄存器间接寻址时还可用通用寄存器存放有效地址的地址。</p></li>
<li><p>数据寄存器：数据寄存器用于存放操作数，其位数应满足多数数据类型的数值范围，有些机器允许使用两个连读的寄存器存放双倍字长的值。还有些机器的数据寄存器只能用于保存数据，不能用于操作数地址的计算。</p></li>
<li><p>地址寄存器：地址寄存器用于存放地址，其本身可以具有通用性，也可用于特殊的导址</p></li>
<li><p>条件码寄存器：这类寄存器中存放条件码，它们对用户来说是部分透明的。条件码是 CPU 根据运算结果由硬件设置的位，例如，算术运算会产生正、负、零或溢出等结果。条件码可被测试，作为分支运算的依据。</p></li>
</ol>
<h4 id="控制寄存器">控制寄存器</h4>
<p>CPU 中还有一类寄存器用于控制 CPU 的操作或运算。在一些机器里，大部分这类寄存器对用户是透明的。如以下四种寄存器在指令执行过程中起重要作用。</p>
<ol type="1">
<li>MAR：存储器地址寄存器，用于存放将被访问的存储单元的地址</li>
<li>MDR：存储器数据寄存器，用于存放即将存入存储单元的数据，或者刚从存储单元中读出的数据</li>
<li>PC（不透明）：程序计数器，用于存放现行指令的地址，通常具备计数功能。且能被某些转移类指令修改</li>
<li>IR：指令寄存器，存放当前执行的指令</li>
</ol>
<h4 id="状态寄存器">状态寄存器</h4>
<ol type="1">
<li>状态寄存器：存放指令执行结果，或者软硬件状态</li>
<li>PSW 寄存器：存放程序码</li>
</ol>
<h2 id="指令周期">指令周期</h2>
<h3 id="基本性质">基本性质</h3>
<p>指令周期：取出并执行一条指令的全部时间。一般来说，可以将其分为 <strong>取指周期</strong> 和 <strong>执行周期</strong>。</p>
<h4 id="指令周期类型">指令周期类型</h4>
<p>显然的，每条指令的指令周期因为指令类型不同而不一样：</p>
<ol type="1">
<li><p>指令周期只有取值周期：NOP，JMP</p>
<p><img src="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/%E6%8C%87%E4%BB%A4%E5%91%A8%E6%9C%9F1.png" alt="image-20220823100920627" style="zoom:80%;" / loading="lazy"></p></li>
<li><p>指令周期有取值周期和执行周期，且两者长度基本相等：ADD</p>
<p><img src="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/%E6%8C%87%E4%BB%A4%E5%91%A8%E6%9C%9F2.png" alt="image-20220823101051004" style="zoom: 80%;" / loading="lazy"></p></li>
<li><p>指令周期有取值周期和执行周期，且后者长于前者：MUL</p>
<p><img src="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/%E6%8C%87%E4%BB%A4%E5%91%A8%E6%9C%9F3.png" alt="image-20220823101206461" style="zoom:80%;" / loading="lazy"></p></li>
<li><p>具有间接寻址的指令周期</p>
<p><img src="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/%E6%8C%87%E4%BB%A4%E5%91%A8%E6%9C%9F4.png" alt="image-20220823101326600" style="zoom:80%;" / loading="lazy"></p></li>
<li><p>具有中断周期的指令周期</p>
<p><img src="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/%E6%8C%87%E4%BB%A4%E5%91%A8%E6%9C%9F5.png" alt="image-20220823101413059" style="zoom:80%;" / loading="lazy"></p></li>
</ol>
<h4 id="指令周期流程">指令周期流程</h4>
<p><img src="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/%E6%8C%87%E4%BB%A4%E5%91%A8%E6%9C%9F%E6%B5%81%E7%A8%8B.png" alt="image-20220823101935137" style="zoom:80%;" / loading="lazy"></p>
<h4 id="cpu-工作周期的标志">CPU 工作周期的标志</h4>
<p>总之，上述 4 个周期都有 CPU 访存操作，只是访存的目的不同。<strong>取指周期</strong> 是为了取指令，<strong>间址周期</strong> 是为了取有效地址，<strong>执行周期</strong> 是为了取操作数（当指令为访存指令时）, <strong>中断周期</strong> 是为了保存程序断点。这 4 个周期又可称为 CPU 的工作周期，为了区别它们，在 CPU 内设置了 4 个 <strong>标志触发器</strong></p>
<p><img src="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/CPU%E5%B7%A5%E4%BD%9C%E5%91%A8%E6%9C%9F%E7%9A%84%E6%A0%87%E8%AF%86.png" alt="image-20220823102943386" style="zoom:80%;" / loading="lazy"></p>
<p>FE、IND、EX 和 INT 分别对应取指、间址、执行和中断 4 个周期，并以“1”状态表示有效，它们分别由 1 → FE、1 → IND、1 → EX 和 1 → INT 这 4 个信号控制。</p>
<h3 id="数据流">数据流</h3>
<h4 id="取值周期的数据流">取值周期的数据流</h4>
<p><img src="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/%E5%8F%96%E5%80%BC%E5%91%A8%E6%9C%9F%E7%9A%84%E6%95%B0%E6%8D%AE%E6%B5%811.png" alt="image-20220823110159861" style="zoom:80%;" / loading="lazy"></p>
<ol type="1">
<li>$(PC)MAR $：当前指令的内存地址送至存储器地址寄存器</li>
<li><span class="math inline">\(1\to R\)</span>：<span class="math inline">\(CU\)</span> 发出 <strong>读控制信号</strong>，经控制总线传送到主存</li>
<li><span class="math inline">\(M(MAR) \to MDR\)</span>：将 <span class="math inline">\(MAR\)</span> 所指的主存中的指令地址的内容，经过数据总线送入 <span class="math inline">\(MDR\)</span></li>
<li><span class="math inline">\(MDR \to IR\)</span>：将指令内容送入 <span class="math inline">\(IR\)</span></li>
<li>$(PC) +1 PC <span class="math inline">\(：\)</span>CU$ 发出控制信号，让 <span class="math inline">\(PC\)</span> 的值加一，形成下一条指令地址</li>
</ol>
<h4 id="间址周期的数据流">间址周期的数据流</h4>
<p><img src="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/%E7%AE%80%E7%9B%B4%E5%91%A8%E6%9C%9F%E7%9A%84%E6%95%B0%E6%8D%AE%E6%B5%81.png" alt="image-20220823112246582" style="zoom:80%;" / loading="lazy"></p>
<ol type="1">
<li><span class="math inline">\(Ad(IR) \to MAR\)</span> 或者 <span class="math inline">\(Ad(MDR)\to MAR\)</span>：将指令的地址码送入 <span class="math inline">\(MAR\)</span></li>
<li><span class="math inline">\(1 \to R\)</span>：<span class="math inline">\(CU\)</span> 发出读控制信号</li>
<li><span class="math inline">\(M(MAR) \to MDR\)</span>：将 <span class="math inline">\(MAR\)</span> 所指的主存中的指令地址的内容，即有效地址 <span class="math inline">\(EA\)</span>，经过数据总线送入 <span class="math inline">\(MDR\)</span></li>
<li><span class="math inline">\(MDR \to Ad(IR)\)</span>：将 <span class="math inline">\(EA\)</span> 送到指令字的地址码字段</li>
</ol>
<h4 id="执行周期的数据流">执行周期的数据流</h4>
<p>由于不同的指令在执行周期的操作不同，因此执行周期的数据流是多种多样的，可能涉及 CPU 内部寄存器间的数据传送、对存储器（或 I/O）进行读写操作或对 ALU 的操作，因此，无法用统一的数据流图表示。</p>
<h4 id="中断周期的数据流">中断周期的数据流</h4>
<p><img src="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/%E4%B8%AD%E6%96%AD%E5%91%A8%E6%9C%9F%E6%95%B0%E6%8D%AE%E6%B5%81.png" alt="image-20220823120003697" style="zoom:80%;" / loading="lazy"></p>
<p>这里用堆栈保存断点，用 <span class="math inline">\(SP\)</span> 表示栈顶地址</p>
<ol type="1">
<li><span class="math inline">\((SP) -1 \to SP,(SP) \to MAR\)</span>：<span class="math inline">\(CU\)</span> 控制将 <span class="math inline">\(SP\)</span> 减一后的地址送入 <span class="math inline">\(MAR\)</span>，即本次断点要存储的目标地址</li>
<li><span class="math inline">\((MAR) \to M\)</span>：<span class="math inline">\(MAR\)</span> 会将地址经过地址总线送入存储器</li>
<li><span class="math inline">\(1 \to W\)</span>：<span class="math inline">\(CU\)</span> 发出控制信号，启动主存做写操作</li>
<li><span class="math inline">\((PC)\to MDR\)</span>：断点的内容（即恢复断点时要执行的下一条指令地址）由 <span class="math inline">\(PC\)</span> 传送给 <span class="math inline">\(MDR\)</span></li>
<li><span class="math inline">\((MDR) \to M\)</span>：<span class="math inline">\(MDR\)</span> 经数据总线，将内容写入 <span class="math inline">\(MAR\)</span> 送入存储器的地址中</li>
<li><span class="math inline">\(\text{向量地址}\to PC\)</span>：<span class="math inline">\(CU\)</span> 控制将中断服务程序的 <strong>入口地址</strong>（由向量地址形成部件产生）送入 <span class="math inline">\(PC\)</span>，开始执行中断程序的内容</li>
</ol>
<h2 id="指令流水">指令流水</h2>
<h3 id="指令流水原理">指令流水原理</h3>
<p>完成一条指令实际上也可分为许多阶段。为简单起见，把指令的处理过程分为取指令和执行指令两个阶段，在不采用流水技术的计算机里，取指令和执行指令是周而复始地重复出现，各条指令按顺序串行执行的。这种顺序执行虽然控制简单，但执行中各部件的利用率不高，如指令部件工作时，执行部件基本空闲，而执行部件工作时，指令部件基本空闲。如果指令执行阶段不访问主存，则完全可以利用这段时间取下一条指令，这样就使取下一条指令的操作和执行当前指令的操作同时进行，这就是指令流水的基本原理，其基本示意图如下</p>
<p><img src="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/%E6%B5%81%E6%B0%B4%E7%BA%BF%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="未命名绘图.drawio" style="zoom:80%;" / loading="lazy"></p>
<ul>
<li>图中展示的称为 <strong>二级流水（一次重叠）</strong>。由指令部件取出一条指令，并将它暂存起来，如果执行部件空闲，就将暂存的指令传给执行部件执行。与此同时，指令部件又可取出下一条指令并暂存起来，这称为 <strong>指令预取</strong>。显然，这种工作方式能加速指令的执行。如果取指和执行阶段在时间上完全重叠，相当于将指令周期减半。</li>
</ul>
<p>然而进一步分析流水线，就会发现存在两个原因使得上述理想情况不会发生</p>
<ol type="1">
<li><strong>指令的执行时间一般大于取指时间</strong>，因此，取指阶段可能要等待一段时间，也即存放在指令部件缓冲区的指令还不能立即传给执行部件，缓冲区不能空出。</li>
<li>当遇到 <strong>条件转移指令</strong> 时，下一条指令是不可知的，因为必须等到执行阶段结束后，才能获知条件是否成立，从而决定下条指令的地址，造成时间损失。通常为了减少时间损失，采用 <strong>猜测法</strong>，即当条件转移指令从取指阶段进入执行阶段时，指令部件仍按顺序预取下一条指令。这样，如果条件不成立，转移没有发生，则没有时间损失；若条件成立，转移发生，则所取的指令必须丢掉，并再取新的指令。</li>
</ol>
<p>尽管这些因素降低了两级流水线的潜在效率，但还是可以获得一定程度的加速。为了进一步提高处理速度，可将指令的处理过程分解为更细的几个阶段，形成六级流水（五次重叠）</p>
<ol type="1">
<li>取指（FI）：从存储器取出一条指令并暂时存入指令部件的缓冲区</li>
<li>指令译码（DI）：确定操作性质和操作数地址的形成方式</li>
<li>计算操作数地址（CO）：计算操作数的有效地址，涉及寄存器间接寻址、间接寻址、变址、基址、相对寻址等各种地址计算方式</li>
<li>取操作数（FO）：从存储器中取操作数（若操作数在寄存器中，则无须此阶段）</li>
<li>执行指令（EI）：执行指令所需的操作，并将结果存于目的位置（寄存器中）</li>
<li>写操作数（WO）：将结果存入存储器</li>
</ol>
<p><img src="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/%E5%85%AD%E7%BA%A7%E6%B5%81%E6%B0%B4.png" alt="image-20220824160353262" style="zoom:80%;" / loading="lazy"></p>
<h3 id="影响指令流水性能的因素">影响指令流水性能的因素</h3>
<h4 id="结构相关">结构相关</h4>
<p>结构相关是当指令在重叠执行过程中，不同指令争用同一功能部件产生资源冲突时产生的，故又有资源相关之称。解决方法有三种：</p>
<ol type="1">
<li>停顿（加入气泡）：即让冲突的两条指令中的后一条，暂停一个时间周期再运行</li>
<li>设置两个独立的存储器分别存放操作数和指令，以免取指令和取操作数同时进行时互相冲突，使取某条指令和取另一条指令的操作数实现时间上的重叠。</li>
<li>指令预取技术，指令预取技术的实现基于访存周期很短的情况。例如，在执行指令阶段，取数时间很短，因此在执行指令时，主存会有空闲，此时，只要指令队列空出，就可取下一条指令，并放至空出的指令队列中，从而保证在执行第 K 条指令的同时对第 K+1 条指令进行译码，实现“执行 K”与“分析 K+1”的重叠。</li>
</ol>
<h4 id="数据相关">数据相关</h4>
<p>数据相关是流水线中的各条指令因重叠操作，可能改变对操作数的读写访问顺序，从而导致了数据相关冲突。根据指令间对同一寄存器读和写操作的先后次序关系，数据相关冲突可分为 <strong>写后读相关</strong>、<strong>读后写相关</strong> 和 <strong>写后写相关</strong>。解决办法有：</p>
<ol type="1">
<li>后推法：采用后推法，即将相关指令延迟到所需操作数被写回到寄存器后再执行的方式</li>
<li>定向技术：又称为旁路技术或相关专用通路技术。其主要思想是不必待某条指令的执行结果送回到寄存器后，再从寄存器中取出该结果，作为下一条指令的源操作数，而是直接将执行结果送到其他指令所需要的地方</li>
</ol>
<h4 id="控制相关">控制相关</h4>
<p>控制相关主要是由转移指令引起的。统计表明，转移指令约占总指令的 1/4 左右，比起数据相关来，它会使流水线丧失更多的性能。执行转移指令时，根据是否发生转移，它可能将程序计数器 <span class="math inline">\(PC\)</span> 内容改变成转移目标地址，也可能只是使 <span class="math inline">\(PC\)</span> 加上一个增量，指向下一条指令的地址。这就意味着，必须等待转移指令完成时才能判断，否则可能进行无效的操作。</p>
<p>为了解决控制相关，可以采用尽早判别转移是否发生，尽早生成转移目标地址；预取转移成功或不成功两个控制流方向上的目标指令；加快和提前形成条件码；提高转移方向的猜准率等方法。</p>
<h3 id="流水线性能指标">流水线性能指标</h3>
<h4 id="吞吐率">吞吐率</h4>
<p>吞吐率是指在单位时间内流水线 <strong>所完成的指令的数量</strong>，或是 <strong>输出结果的数量</strong>，有 <strong>最大吞吐率</strong> 和 <strong>实际吞吐率</strong> 之分。流水线仅在连续流动（满负荷，无相关因素影响）时才可达到最大吞吐率。实际上由于流水线在开始时有一段建立时间（第一条指令输入后到其完成的时间），结束时有一段排空时间（最后一条指令输入后到其完成的时间），以及由于各种相关因素使流水线无法连续流动。因此，实际吞吐率总是小于最大吞吐率。</p>
<p>设任务数（指令数）为 <span class="math inline">\(n\)</span>，各指令分为 <span class="math inline">\(k\)</span> 段，<span class="math inline">\(k\)</span> 段流水线各段时间为 <span class="math inline">\(\Delta t\)</span>，花费的总时间为 <span class="math inline">\(T_k\)</span></p>
<p>则吞吐率 <span class="math inline">\(T_p = \frac{n}{T_k}\)</span></p>
<p><img src="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/%E5%90%9E%E5%90%90%E7%8E%871.png" alt="image-20220824172449420" style="zoom:80%;" / loading="lazy"></p>
<p>观察上图，不难发现：第一条指令耗费的时间（装入时间）为 <span class="math inline">\(k\Delta t\)</span>，而后每经过 <span class="math inline">\(\Delta t\)</span>，都有一条指令完成</p>
<p>所以总时间 <span class="math inline">\(T_k = (k+n-1)\Delta t\)</span>，就可以得到</p>
<p>实际吞吐率 <span class="math inline">\(T_p = \frac{n}{ (k+n-1)\Delta t}\)</span></p>
<p>最大吞吐率 <span class="math inline">\(T_{pmax} = \lim_{n \to \infty} T_p = \frac{1}{\Delta t}\)</span></p>
<h4 id="加速比">加速比</h4>
<p>流水线的加速比是指 <span class="math inline">\(k\)</span> 段流水线的速度与等功能的非流水线的速度之比</p>
<p>设 <span class="math inline">\(T_0\)</span> 表示不使用流水线时的执行时间，即顺序执行所用的时间；<span class="math inline">\(T_k\)</span> 表示使用流水线时的执行时间。则计算流水线加速比的基本公式为 <span class="math inline">\(S_p = \frac{T_0}{T_k}\)</span> <span class="math display">\[
S_p =\frac{n k \Delta t}{(k+n-1) \Delta t}=\frac{k n}{k+n-1}
\]</span> 同样的，最大加速比 <span class="math inline">\(S_{pmax} = \lim_{n \to \infty} S_p = k\)</span>，即流水线的段数</p>
<h4 id="效率">效率</h4>
<p>指流水线的设备利用率，由于流水线有建立时间和排空时间，因此各功能段的设备不可能一直处于工作状态，总有一段空闲时间。</p>
<p><img src="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/%E6%B5%81%E6%B0%B4%E7%BA%BF%E6%95%88%E7%8E%87%E5%9B%BE.png" alt="image-20220824173826613" style="zoom:80%;" / loading="lazy"></p>
<p>在时空图上，流水线的效率定义为完成 <span class="math inline">\(n\)</span> 个任务占用的时空区有效面积与 <span class="math inline">\(n\)</span> 个任务所用的时间与 <span class="math inline">\(k\)</span> 个流水段所围成的时空区总面积之比，则效率 <span class="math inline">\(E = \frac{T_0}{k T_k }\)</span> <span class="math display">\[
E =\frac{n k \Delta t}{k(k+n-1) \Delta t}=\frac{n}{k+n-1}
\]</span></p>
<p>同样的，最大效率 <span class="math inline">\(E_{max} = \lim_{n \to \infty}E = 1\)</span>，即满效率</p>
<h3 id="流水线的多发技术">流水线的多发技术</h3>
<h4 id="超标量技术">超标量技术</h4>
<p>它是指在每个时钟周期内可同时并发多条独立指令，即以并行操作方式将两条或两条以上指令编译并执行。要实现超标量技术，要求处理机中配置多个功能部件和指令译码电路，以及多个寄存器端口和总线，以便能实现同时执行多个操作，此外还要编译程序决定哪几条相邻指令可并行执行。</p>
<p><img src="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/%E8%B6%85%E6%A0%87%E9%87%8F%E6%8A%80%E6%9C%AF.png" alt="image-20220824175701402" style="zoom:80%;" / loading="lazy"></p>
<h4 id="超流水线技术">超流水线技术</h4>
<p>将一些流水线寄存器插入到流水线段中，好比将流水线再分段。图中将原来的一个时钟周期又分成 3 段，使超流水线的处理器周期比普通流水线的处理器周期短，这样，在原来的时钟周期内，功能部件被使用 3 次，使流水线以 3 倍于原来时钟频率的速度运行。与超标量计算机一样，硬件不能调整指令的执行顺序，靠编译程序解决优化问题。</p>
<p><img src="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/%E8%B6%85%E6%B5%81%E6%B0%B4%E7%BA%BF%E6%8A%80%E6%9C%AF6.png" alt="image-20220824175826030" style="zoom:80%;" / loading="lazy"></p>
<h4 id="超长指令字技术">超长指令字技术</h4>
<p>超长指令字（VLIW）技术和超标量技术都是采用多条指令在多个处理部件中并行处理的体系结构，在一个时钟周期内能流出多条指令。但超标量的指令来自同一标准的指令流，VLIW 则是由编译程序在编译时挖掘出指令间潜在的并行性后，把多条能并行操作的指令组合成一条具有多个操作码字段的超长指令（指令字长可达几百位），由这条超长指令控制 VLIW 机中多个独立工作的功能部件，由每一个操作码字段控制一个功能部件，相当于同时执行多条指令。VLIW 较超标量具有更高的并行处理能力，但对优化编译器的要求更高，对 Cache 的容量要求更大。</p>
<p><img src="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/%E8%B6%85%E9%95%BF%E6%8C%87%E4%BB%A4%E5%AD%97%E6%8A%80%E6%9C%AF.png" alt="image-20220824175943831" style="zoom:80%;" / loading="lazy"></p>
<h2 id="中断系统">中断系统</h2>
<h3 id="概述">概述</h3>
<p>从前面分析可知，采用中断方式实现主机与 I/O 交换信息可使 CPU 和 I/O 并行工作，提高 CPU 的效率。其实，计算机在运行过程中，除了会遇到 I/O 中断外，还有许多意外事件发生，如电源突然掉电，机器硬件突然出现故障，人们在机器运行过程中想随机抽查计算的中间结果，实现人机联系等。此外，在实时处理系统中，必须及时处理某个事件或现象，例如，在过程控制系统中，当突然出现温度过高、电压过大等情况时，必须及时将这些信息送至计算机；由计算机暂时中断现行程序，转去执行中断服务程序，以解决这种异常情况。再如，计算机实现多道程序运行时， 可以通过分配给每道程序一个固定时间片，利用时钟定时发中断进行程序切换。在多处理机系统中，各处理器之间的信息交流和任务切换也可通过中断来实现。总之，为了提高计算机的效率，为了处理一些异常情况以及实时控制、多道程序和多处理机的需要，提出了中断的概念。</p>
<h4 id="引起中断的因素">引起中断的因素</h4>
<ol type="1">
<li><p>人为设置的中断</p>
<p>这种中断一般称为 <strong>自愿中断</strong>，因为它是在程序中人为设置的，故一旦机器执行这种人为中断，便自愿停止现行程序而转入中断处理。比如 <strong>转管指令</strong>，是转至从 I/O 设备调入一批信息到主存的管理程序，也可能是转至将一批数据送往打印机打印的管理程序。显然，当用户程序执行了“转管指令”后，便中断现行程序，转入管理程序，这种转移完全是自愿的。</p></li>
<li><p><strong>转管指令</strong></p></li>
<li><p>程序性事故：溢出、操作码不能识别、除法非法</p></li>
<li><p>硬件故障：存储器故障、硬盘坏道、掉电</p></li>
<li><p>I/O 设备</p></li>
<li><p>外部事件：键盘中断键</p></li>
</ol>
<h3 id="中断请求标记和中断判优逻辑">中断请求标记和中断判优逻辑</h3>
<h4 id="中断请求标记">中断请求标记</h4>
<p>为了判断是哪个中断源提出请求，在中断系统中必须设置中断请求标记触发器，简称 <strong>中断请求触发器</strong>，记作 INTR。当其状态为“1”时，表示中断源有请求。这种触发器可集中设在 CPU 内， 组成一个中断请求标记寄存器。这些触发器既可以集中在 CPU 的中断系统内，也可以分散到各个中断源中（链式排队器）。</p>
<h4 id="中断判优逻辑">中断判优逻辑</h4>
<p>任何一个中断系统，在任一时刻，只能响应一个中断源的请求。但许多中断源提出请求都是随机的，当某一时刻有多个中断源提出中断请求时，中断系统必须按其优先顺序予以响应，这称为中断判优。其可以用 <strong>硬件实现</strong>，也可用 <strong>软件实现</strong></p>
<p>硬件实现</p>
<ol type="1">
<li><p>分散在各个中断源中的接口电路 <strong>链式排队器</strong></p></li>
<li><p>集中在 CPU 中</p></li>
</ol>
<p><img src="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/CPU%E4%B8%AD%E6%96%AD%E5%88%A4%E4%BC%98.png" alt="image-20220828143507273" style="zoom:80%;" / loading="lazy"></p>
<p>软件实现</p>
<ol type="1">
<li><p>程序查询</p>
<p><img src="https://imgbed-1304793179.cos.ap-nanjing.myqcloud.com/typora/%E8%BD%AF%E4%BB%B6%E5%AE%9E%E7%8E%B0%E4%B8%AD%E6%96%AD.png" alt="image-20220828143727207" style="zoom:67%;" / loading="lazy"></p></li>
</ol>
<h3 id="中断服务程序地址的寻找">中断服务程序地址的寻找</h3>
<ol type="1">
<li><p>硬件向量法</p>
<p>硬件向量法就是利用硬件产生 <strong>向量地址</strong>，再由向量地址找到中断服务程序的入口地址。向量地址由 <strong>中断向量地址形成部件</strong> 产生，这个电路可分散设置在各个接口电路中）, 也可设置在 CPU 内。由向量地址寻找中断服务程序的入口地址通常采用两种办法。一种在向量地址内存放一条 <strong>无条件转移指令</strong>，CPU 响应中断时，只要将向量地址送至 PC, 执行这条指令，便可无条件转向服务程序的入口地址。另一种是设置 <strong>向量地址表</strong>，该表设在存储器内，<strong>存储单元的地址为向量地址，存储单元的内容为入口地址</strong>，只要访问向量地址所指示的存储单元，便可获得入口地址。</p></li>
<li><p>软件查询法</p>
<p>用软件寻找中断服务程序入口地址的方法称为软件查询法。当查到某一中断源有中断请求时，接着安排一条 <strong>转移指令</strong>，直接指向此中断源的中断服务程序入口地址，机器便能自动进入中断处理。至于各中断源对应的人口地址，则由程序员（或系统）事先确定。这种方法不涉及硬设备，但查询时间较长。计算机可具备软、硬件两种方法寻找入口地址，使用户使用更方便、灵活。</p></li>
</ol>
<h3 id="中断响应">中断响应</h3>
<h4 id="响应中断的条件">响应中断的条件</h4>
<p>允许中断触发器 <span class="math inline">\(EINT =1\)</span></p>
<h4 id="响应中断的时间">响应中断的时间</h4>
<p>CPU 总是在指令执行周期结束后，响应任何中断源的请求。在指令执行周期结束后，CPU 向所有中断源发中断查询信号，CPU 获知哪个中断源有请求。若有中断，CPU 则进入中断周期；若无中断，则进入下一条指令的取指周期。在某些计算机中，有些指令执行时间很长，若 CPU 的查询信号一律安排在执行周期结束时刻，有可能因 CPU 发现中断请求过迟而出差错。为此，可在指令执行过程中设置若干个查询断点，CPU 在每个“查询断点”时刻均发中断查询信号，以便发现有中断请求便可及时响应。</p>
<h4 id="中断隐指令">中断隐指令</h4>
<p>CPU 中断后，进入中断周期。在该周期内，CPU 会完成一系列的工作</p>
<ol type="1">
<li><p>保护程序断点</p>
<p>将当前程序计数器 <span class="math inline">\(PC\)</span> 的内容保存到存储器中的特定单元(0 号地址)内，也可以存入堆栈</p></li>
<li><p>寻找中断服务程序的入口地址</p>
<p>可以使用 <strong>硬件向量法</strong> 或者 <strong>程序查询法</strong> 得到入口地址，将入口地址送至 <span class="math inline">\(PC\)</span>。然后硬件向量法使用无条件转移指令，程序查询法 CPU 执行中断识别程序</p></li>
<li><p>关中断</p>
<p>CPU 进入中断周期，意味着 CPU 响应了某个中断源的请求，为了确保 CPU 响应后所需做的一系列操作不至于又受到新的中断请求的干扰，在中断周期内必须自动关中断，以禁止 CPU 再次响应新的中断请求。</p></li>
</ol>
<h3 id="中断屏蔽技术">中断屏蔽技术</h3>
<p>当 CPU 正在执行某个中断服务程序时，另一个中断源又提出了新的中断请求，而 CPU 又应了这个新的请求，暂时停止正在运行的服务程序，转去执行新的中断服务程序，这称为多重中断，又称中断嵌套，如果 CPU 对新的请求不予响应，待执行完当前的服务程后再响应，即为单重中断。中断系统若要具有处理多重中断的功能，必须具备各项条件。</p>
<h4 id="实现多重中断的条件">实现多重中断的条件</h4>
<ol type="1">
<li>提前设置开中断指令</li>
<li>优先级高的中断源有权中断优先级别低的中断源</li>
</ol>
<h4 id="屏蔽技术">屏蔽技术</h4>
<ol type="1">
<li>屏蔽触发器与屏蔽字</li>
<li>屏蔽技术可改变优先等级 严格地说，优先级包含响应优先级和处理优先级。响应优先级是指 CPU 响应各中断源请求的优先次序，这种次序往往是硬件线路已设置好的，不便于改动。处理优先级是指 CPU 实际对各中断源请求的处理优先次序。如果不采用屏蔽技术，响应的优先次序就是处理的优先次序。采用了屏蔽技术后，可以改变 CPU 处理各中断源的优先等级，从而改变 CPU 执行程序的轨迹。</li>
</ol>
</div></section><ul class="post-copyright"><li class="post-copyright-author"><strong>Post author: </strong>Anduin9527</li><li class="post-copyright-link"><strong>Post link: </strong><a href="http://lapras.xyz/2022/08/28/be6f31dd.html" title="计算机组成原理笔记（八）">http://lapras.xyz/2022/08/28/be6f31dd.html</a></li><li class="post-copyright-license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><span class="icon iconify" data-icon="ri:creative-commons-line"></span><span class="icon iconify" data-icon="ri:creative-commons-by-line"></span><span class="icon iconify" data-icon="ri:creative-commons-nc-line"></span><span class="icon iconify" data-icon="ri:creative-commons-sa-line"></span></a> unless otherwise stated.</li></ul></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2022/08/29/c4a21082.html" rel="prev" title="计算机组成原理笔记（九）"><span class="icon iconify" data-icon="ri:arrow-left-s-line"></span><span class="post-nav-text">计算机组成原理笔记（九）</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2022/08/21/4904199e.html" rel="next" title="计算机组成原理笔记（七）"><span class="post-nav-text">计算机组成原理笔记（七）</span><span class="icon iconify" data-icon="ri:arrow-right-s-line"></span></a></div></div></div><div class="hty-card" id="comment"><div class="comment-tooltip text-center"><span>如果您有任何关于博客内容的相关讨论，欢迎与我交流。</span><br></div></div></main><footer class="sidebar-translate" id="footer"><div class="beian"><a rel="noopener" href="https://beian.miit.gov.cn/" target="_blank">闽ICP备2021012704号</a></div><div class="copyright"><span>&copy; 2020 – 2022 </span><span class="with-love" id="animate"><span class="icon iconify" data-icon="ri:cloud-line"></span></span><span class="author"> Anduin9527</span></div><div class="powered"><span>Powered by <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> v6.2.0</span><span class="footer-separator">|</span><span>Theme - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.10.6</span></div></footer></div><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><span class="icon iconify" data-icon="ri:arrow-up-s-line"></span><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#66d6ff" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" target="_blank" rel="noopener" href="https://www.google.com/search?q=site:lapras.xyz" title="Search"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:search-line"></span></span></a><script>function initMourn() {
  const date = new Date();
  const today = (date.getMonth() + 1) + "-" + date.getDate()
  const mourn_days = ["4-4","9-18","5-12","12-13"]
  if (mourn_days.includes(today)) {
    document.documentElement.style.filter = "grayscale(1)";
  }
}
initMourn();</script></body></html>